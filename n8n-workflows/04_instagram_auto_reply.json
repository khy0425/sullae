{
  "name": "ìˆ ëž˜ - Instagram ìžë™ ì‘ë‹µ",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 5
            }
          ]
        }
      },
      "id": "schedule-ig",
      "name": "Schedule - Every 5 min",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "url": "https://graph.facebook.com/v18.0/={{ $credentials.instagramBusinessAccountId }}/media",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "options": {},
        "queryParameters": {
          "parameters": [
            {
              "name": "fields",
              "value": "id,comments.limit(50){id,text,from,timestamp,replies}"
            }
          ]
        }
      },
      "id": "http-ig-1",
      "name": "Get Recent Media & Comments",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [450, 300],
      "credentials": {
        "httpQueryAuth": {
          "id": "YOUR_IG_CREDENTIAL_ID",
          "name": "Instagram Graph API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.first().json.data || [];\nconst keywords = {\n  download: ['ë‹¤ìš´', 'ì•±', 'ì–´ë””ì„œ', 'ì„¤ì¹˜', 'ë‹¤ìš´ë¡œë“œ'],\n  howto: ['ì–´ë–»ê²Œ', 'ì°¸ê°€', 'ë°©ë²•', 'ê°€ìž…'],\n  location: ['ì„œìš¸', 'ê²½ê¸°', 'ë¶€ì‚°', 'ëŒ€êµ¬', 'ì¸ì²œ'],\n  positive: ['ìž¬ë°Œ', 'ì¢‹ì•„', 'êµ¿', 'ëŒ€ë°•', 'ìµœê³ ']\n};\n\nconst responses = {\n  download: 'ì•± ë‹¤ìš´ë¡œë“œëŠ” í”„ë¡œí•„ ë§í¬ì—ì„œ! ðŸƒ ë™ë„¤ì—ì„œ ìˆ ëž˜ìž¡ê¸° ê°™ì´í•´ìš”!',\n  howto: 'ì•± ì„¤ì¹˜ í›„ ì°¸ê°€ì½”ë“œ ìž…ë ¥í•˜ë©´ ë! ì‰½ì£ ? ðŸ˜Š',\n  location: 'í•´ë‹¹ ì§€ì—­ ëª¨ìž„ ìžˆì–´ìš”! ì•±ì—ì„œ í™•ì¸í•´ë³´ì„¸ìš” ðŸ“',\n  positive: 'ê°ì‚¬í•©ë‹ˆë‹¤! ë‹¤ìŒì— ê°™ì´ ë›°ì–´ìš” ðŸƒâ€â™‚ï¸'\n};\n\nconst results = [];\n\nfor (const media of items) {\n  const comments = media.comments?.data || [];\n  \n  for (const comment of comments) {\n    // ì´ë¯¸ ë‹µê¸€ì´ ìžˆìœ¼ë©´ ìŠ¤í‚µ\n    if (comment.replies?.data?.length > 0) continue;\n    \n    const text = comment.text.toLowerCase();\n    let responseType = null;\n    \n    // í‚¤ì›Œë“œ ë§¤ì¹­\n    for (const [type, words] of Object.entries(keywords)) {\n      if (words.some(word => text.includes(word))) {\n        responseType = type;\n        break;\n      }\n    }\n    \n    if (responseType) {\n      results.push({\n        commentId: comment.id,\n        username: comment.from?.username || 'user',\n        originalText: comment.text,\n        responseType,\n        response: `@${comment.from?.username || 'user'} ${responses[responseType]}`\n      });\n    }\n  }\n}\n\nreturn results.map(r => ({ json: r }));"
      },
      "id": "code-ig-1",
      "name": "Filter & Match Keywords",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v18.0/{{ $json.commentId }}/replies",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpQueryAuth",
        "method": "POST",
        "body": {
          "mode": "fields",
          "fields": [
            {
              "name": "message",
              "value": "={{ $json.response }}"
            }
          ]
        },
        "options": {}
      },
      "id": "http-ig-2",
      "name": "Reply to Comment",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [850, 300],
      "credentials": {
        "httpQueryAuth": {
          "id": "YOUR_IG_CREDENTIAL_ID",
          "name": "Instagram Graph API"
        }
      }
    },
    {
      "parameters": {
        "batchSize": 1,
        "options": {
          "reset": false
        }
      },
      "id": "split-ig",
      "name": "Rate Limit (1 per batch)",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [750, 300]
    },
    {
      "parameters": {
        "amount": 2,
        "unit": "seconds"
      },
      "id": "wait-ig",
      "name": "Wait 2 seconds",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [950, 400]
    }
  ],
  "connections": {
    "Schedule - Every 5 min": {
      "main": [
        [
          {
            "node": "Get Recent Media & Comments",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Recent Media & Comments": {
      "main": [
        [
          {
            "node": "Filter & Match Keywords",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter & Match Keywords": {
      "main": [
        [
          {
            "node": "Rate Limit (1 per batch)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limit (1 per batch)": {
      "main": [
        [
          {
            "node": "Reply to Comment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reply to Comment": {
      "main": [
        [
          {
            "node": "Wait 2 seconds",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait 2 seconds": {
      "main": [
        [
          {
            "node": "Rate Limit (1 per batch)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "tags": [
    {
      "name": "ìˆ ëž˜"
    },
    {
      "name": "Instagram"
    }
  ]
}
