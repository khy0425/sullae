{
  "rules": {
    // 기본 거부
    ".read": false,
    ".write": false,

    // 실시간 게임 상태 (게임 진행 중 사용)
    "gameStates": {
      "$meetingId": {
        // 읽기: 모임 참가자만
        ".read": "auth != null",

        // 쓰기: 모임 참가자만
        ".write": "auth != null",

        // 게임 상태 필드
        "status": {
          ".validate": "newData.isString() && newData.val().matches(/^(waiting|countdown|playing|paused|ended)$/)"
        },
        "round": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        },
        "startedAt": {
          ".validate": "newData.isNumber()"
        },
        "endedAt": {
          ".validate": "newData.isNumber()"
        },

        // 플레이어 상태
        "players": {
          "$playerId": {
            ".read": "auth != null",
            ".write": "auth != null && auth.uid == $playerId",

            "role": {
              ".validate": "newData.isString() && newData.val().matches(/^(seeker|hider|cop|robber|tagger|runner)$/)"
            },
            "isTagged": {
              ".validate": "newData.isBoolean()"
            },
            "taggedAt": {
              ".validate": "newData.isNumber()"
            },
            "lastActiveAt": {
              ".validate": "newData.isNumber()"
            },
            "location": {
              "latitude": {
                ".validate": "newData.isNumber()"
              },
              "longitude": {
                ".validate": "newData.isNumber()"
              },
              "updatedAt": {
                ".validate": "newData.isNumber()"
              }
            }
          }
        },

        // 게임 이벤트 로그
        "events": {
          "$eventId": {
            ".validate": "newData.hasChildren(['type', 'timestamp'])",
            "type": {
              ".validate": "newData.isString()"
            },
            "timestamp": {
              ".validate": "newData.isNumber()"
            }
          }
        }
      }
    },

    // 실시간 위치 공유 (게임 중)
    "locations": {
      "$meetingId": {
        "$userId": {
          // 읽기: 같은 모임 참가자만
          ".read": "auth != null",

          // 쓰기: 본인만
          ".write": "auth != null && auth.uid == $userId",

          ".validate": "newData.hasChildren(['latitude', 'longitude', 'updatedAt'])",
          "latitude": {
            ".validate": "newData.isNumber() && newData.val() >= -90 && newData.val() <= 90"
          },
          "longitude": {
            ".validate": "newData.isNumber() && newData.val() >= -180 && newData.val() <= 180"
          },
          "updatedAt": {
            ".validate": "newData.isNumber()"
          }
        }
      }
    },

    // 실시간 Presence (온라인 상태)
    "presence": {
      "$meetingId": {
        "$userId": {
          // 읽기: 같은 모임 참가자만
          ".read": "auth != null",

          // 쓰기: 본인만
          ".write": "auth != null && auth.uid == $userId",

          "isOnline": {
            ".validate": "newData.isBoolean()"
          },
          "lastSeen": {
            ".validate": "newData.isNumber()"
          }
        }
      }
    },

    // 타이머 동기화 (게임 타이머)
    "timers": {
      "$meetingId": {
        // 읽기: 모임 참가자
        ".read": "auth != null",

        // 쓰기: 방장만 (클라이언트에서 검증 어려우므로 서버 검증 권장)
        ".write": "auth != null",

        "type": {
          ".validate": "newData.isString() && newData.val().matches(/^(countdown|game|hide|seek)$/)"
        },
        "duration": {
          ".validate": "newData.isNumber() && newData.val() > 0"
        },
        "startedAt": {
          ".validate": "newData.isNumber()"
        },
        "pausedAt": {
          ".validate": "newData.isNumber() || !newData.exists()"
        },
        "isRunning": {
          ".validate": "newData.isBoolean()"
        }
      }
    }
  }
}
